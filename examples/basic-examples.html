<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>CSS Custom Functions polyfill - Examples</title>
		<style>
			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				margin: 0;
				padding: 20px;
				background-color: #f5f5f5;
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
				background: white;
				padding: 30px;
				border-radius: 10px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			}

			h1 {
				color: #333;
				text-align: center;
				margin-bottom: 30px;
			}

			.example {
				margin-bottom: 40px;
				padding: 20px;
				border: 1px solid #ddd;
				border-radius: 8px;
				background-color: #fafafa;
			}

			.example h3 {
				color: #555;
				margin-top: 0;
			}

			.example-code {
				background-color: #f8f8f8;
				padding: 15px;
				border-radius: 5px;
				font-family: "Courier New", monospace;
				margin: 10px 0;
				overflow-x: auto;
			}

			.example-result {
				padding: 15px;
				border: 2px solid #007acc;
				border-radius: 5px;
				background-color: white;
			}

			/* CSS Custom Functions examples - these will be processed by the polyfill */
			@function --responsive-font-size() {
				result: 16px;

				@media (width >=768px) {
					result: 24px;
				}
			}

			@function --responsive-color() {
				result: #666;

				@media (width >=768px) {
					result: #333;
				}
			}

			.responsive-text {
				font-size: --responsive-font-size();
				color: --responsive-color();
			}

			@function --grid-display() {
				result: flex;

				@supports (display: grid) {
					result: grid;
				}
			}

			@function --grid-gap() {
				result: 0;

				@supports (gap) {
					result: 20px;
				}
			}

			@function --grid-columns() {
				result: none;

				@supports (display: grid) {
					result: repeat(3, 1fr);
				}
			}

			.grid-fallback {
				display: --grid-display();
				gap: --grid-gap();
				grid-template-columns: --grid-columns();
			}

			@function --grid-item-margin() {
				result: 10px;

				@supports (gap) {
					result: 0;
				}
			}

			.grid-fallback > div {
				padding: 20px;
				background-color: #e3f2fd;
				border-radius: 5px;
				margin: --grid-item-margin();
			}

			@function --custom-props-bg() {
				result: #f44336;

				@supports (--custom: value) {
					result: #4caf50;
				}
			}

			.custom-property-check {
				background-color: --custom-props-bg();
				color: white;
				padding: 15px;
				border-radius: 5px;
				text-align: center;
			}

			@function --theme-bg() {
				result: #fff;

				@media (prefers-color-scheme: dark) {
					result: #333;
				}
			}

			@function --theme-color() {
				result: #333;

				@media (prefers-color-scheme: dark) {
					result: #fff;
				}
			}

			@function --theme-border() {
				result: #ddd;

				@media (prefers-color-scheme: dark) {
					result: #555;
				}
			}

			.theme-aware {
				background-color: --theme-bg();
				color: --theme-color();
				padding: 20px;
				border-radius: 5px;
				border: 1px solid --theme-border();
			}

			@function --hover-bg() {
				result: #90caf9;

				@supports (: hover) {
					result: #2196f3;
				}
			}

			.hover-effect {
				transition: all 0.3s ease;
				padding: 15px;
				border-radius: 5px;
				background-color: --hover-bg();
				color: white;
				cursor: pointer;
			}

			@function --hover-active-bg() {
				result: #2196f3;

				@supports (: hover) {
					result: #1976d2;
				}
			}

			@function --hover-transform() {
				result: none;

				@supports (transform) {
					result: translateY(-2px);
				}
			}

			.hover-effect:hover {
				background-color: --hover-active-bg();
				transform: --hover-transform();
			}

			.status-indicator {
				padding: 10px;
				border-radius: 5px;
				margin: 10px 0;
				font-weight: bold;
			}

			.native-support {
				background-color: #4caf50;
				color: white;
			}

			.polyfill-active {
				background-color: #ff9800;
				color: white;
			}

			.controls {
				margin: 20px 0;
				text-align: center;
			}

			button {
				padding: 10px 20px;
				margin: 0 10px;
				border: none;
				border-radius: 5px;
				background-color: #007acc;
				color: white;
				cursor: pointer;
				font-size: 16px;
			}

			button:hover {
				background-color: #005a9e;
			}

			.footer-note {
				margin-top: 40px;
				padding: 20px;
				background-color: #e8f5e8;
				border-radius: 5px;
			}
		</style>
	</head>

	<body>
		<div class="container">
			<h1>CSS Custom Functions polyfill Examples</h1>

			<div id="status" class="status-indicator"></div>

			<div class="controls">
				<button type="button" class="refreshPolyfill">
					Refresh Polyfill
				</button>
				<button type="button" class="toggleDebug">Toggle Debug</button>
				<button type="button" class="testProcessing">
					Test CSS Processing
				</button>
			</div>

			<div class="example">
				<h3>1. Responsive Typography</h3>
				<div class="example-code">
					@function --responsive-font-size() {<br />
					&nbsp;&nbsp;result: 16px;<br />
					&nbsp;&nbsp;@media (width &gt;= 768px) {<br />
					&nbsp;&nbsp;&nbsp;&nbsp;result: 24px;<br />
					&nbsp;&nbsp;}<br />
					}<br />
					<br />
					.responsive-text {<br />
					&nbsp;&nbsp;font-size: --responsive-font-size();<br />
					}
				</div>
				<div class="example-result responsive-text">
					This text changes size and color based on screen width!
				</div>
			</div>

			<div class="example">
				<h3>2. Grid with Flexbox Fallback</h3>
				<div class="example-code">
					@function --grid-display() {<br />
					&nbsp;&nbsp;result: flex;<br />
					&nbsp;&nbsp;@supports (display: grid) {<br />
					&nbsp;&nbsp;&nbsp;&nbsp;result: grid;<br />
					&nbsp;&nbsp;}<br />
					}<br />
					<br />
					.grid-fallback {<br />
					&nbsp;&nbsp;display: --grid-display();<br />
					}
				</div>
				<div class="example-result">
					<div class="grid-fallback">
						<div>Item 1</div>
						<div>Item 2</div>
						<div>Item 3</div>
					</div>
				</div>
			</div>

			<div class="example">
				<h3>3. Custom Properties Support Detection</h3>
				<div class="example-code">
					@function --custom-props-bg() {<br />
					&nbsp;&nbsp;result: #f44336;<br />
					&nbsp;&nbsp;@supports (--custom: value) {<br />
					&nbsp;&nbsp;&nbsp;&nbsp;result: #4caf50;<br />
					&nbsp;&nbsp;}<br />
					}<br />
					<br />
					.custom-property-check {<br />
					&nbsp;&nbsp;background-color: --custom-props-bg();<br />
					}
				</div>
				<div class="example-result custom-property-check">
					CSS Custom Properties:
					<span id="custom-props-status">Checking...</span>
				</div>
			</div>

			<div class="example">
				<h3>4. Dark Mode Support</h3>
				<p>
					Whereas technically possible, it might be much easier and
					stable to use the standardized and well supported
					<a
						href="https://developer.mozilla.org/en-US/docs/Web/CSS/color_value/light-dark"
						><code>light-dark</code> CSS function</a
					>
					for this.
				</p>
				<div class="example-code">
					@function --theme-bg() {<br />
					&nbsp;&nbsp;result: #fff;<br />
					&nbsp;&nbsp;@media (prefers-color-scheme: dark) {<br />
					&nbsp;&nbsp;&nbsp;&nbsp;result: #333;<br />
					&nbsp;&nbsp;}<br />
					}<br />
					<br />
					.theme-aware {<br />
					&nbsp;&nbsp;background-color: --theme-bg();<br />
					}
				</div>
				<div class="example-result theme-aware">
					This element adapts to your system's dark mode preference!
				</div>
			</div>

			<div class="example">
				<h3>5. Hover Effects with Fallback</h3>
				<div class="example-code">
					@function --hover-bg() {<br />
					&nbsp;&nbsp;result: #90caf9;<br />
					&nbsp;&nbsp;@supports (:hover) {<br />
					&nbsp;&nbsp;&nbsp;&nbsp;result: #2196f3;<br />
					&nbsp;&nbsp;}<br />
					}<br />
					<br />
					.hover-effect {<br />
					&nbsp;&nbsp;background-color: --hover-bg();<br />
					}
				</div>
				<div class="example-result hover-effect">
					Hover over me! (Fallback styling for touch devices)
				</div>
			</div>

			<div class="example">
				<h3>6. Manual CSS Processing</h3>
				<div class="example-code">
					<div id="manual-css-input">
						@function --test-color() { result: blue; @supports
						(display: grid) { result: red; } } .test { color:
						--test-color(); background: yellow; }
					</div>
				</div>
				<div class="example-result">
					<div id="manual-css-output">
						Click "Test CSS Processing" button to see the result
					</div>
				</div>
			</div>

			<div class="footer-note">
				<h3>ðŸš€ CSS Custom Functions Features Demonstrated:</h3>
				<ul>
					<li>âœ… Basic function definitions</li>
					<li>âœ… Responsive design with @media queries</li>
					<li>âœ… Grid fallbacks with @supports</li>
					<li>âœ… Custom property detection</li>
					<li>âœ… Theme-aware color functions</li>
					<li>âœ… Interactive hover effects</li>
				</ul>
			</div>
		</div>

		<script type="module">
			import { init } from "../packages/css-custom-functions-polyfill/dist/index.modern.js";

			// Initialize the polyfill
			init(); // Update status indicator
			function updateStatus() {
				const statusEl = document.getElementById("status");
				const hasNative = CSSIfPolyfill.hasNativeSupport();

				if (hasNative) {
					statusEl.textContent =
						"Native CSS Custom Function support detected";
					statusEl.className = "status-indicator native-support";
				} else {
					statusEl.textContent =
						"CSS Custom Functions polyfill is active";
					statusEl.className = "status-indicator polyfill-active";
				}
			}

			// Update custom properties status
			function escapeHtml(unsafe) {
				return unsafe
					.replace(/&/g, "&amp;")
					.replace(/</g, "&lt;")
					.replace(/>/g, "&gt;")
					.replace(/"/g, "&quot;")
					.replace(/'/g, "&#039;");
			}

			function updateCustomPropsStatus() {
				const statusEl = document.getElementById("custom-props-status");
				const hasSupport = CSS.supports("--custom", "value");
				statusEl.textContent = hasSupport
					? "Supported"
					: "Not Supported";
			}

			// Control functions
			document.querySelector(".refreshPolyfill").onclick = function () {
				CSSIfPolyfill.refresh();
				console.log("Polyfill refreshed");
			};

			let debugEnabled = true;
			document.querySelector(".toggleDebug").onclick = function () {
				// Toggle debug mode
				debugEnabled = !debugEnabled;
				CSSIfPolyfill.options.debug = debugEnabled;
				console.log(
					"Debug mode:",
					debugEnabled ? "enabled" : "disabled"
				);
			};

			document.querySelector(".testProcessing").onclick = function () {
				// Test manual CSS processing
				const inputEl = document.getElementById("manual-css-input");
				const outputEl = document.getElementById("manual-css-output");

				const inputCSS = inputEl.textContent.trim();
				const outputCSS = CSSIfPolyfill.processCSSText(inputCSS);

				outputEl.innerHTML = `
              <strong>Input:</strong> ${escapeHtml(inputCSS)}<br>
              <strong>Output:</strong> ${escapeHtml(outputCSS)}
          `;
			};

			// Initialize on page load
			document.addEventListener("DOMContentLoaded", function () {
				updateStatus();
				updateCustomPropsStatus();

				// Add some dynamic content after a delay to test mutation observer
				setTimeout(() => {
					const dynamicStyle = document.createElement("style");
					dynamicStyle.textContent = `
						@function --dynamic-color() {
							result: orange;
							@media (width >= 1024px) {
								result: purple;
							}
						}

						@function --dynamic-weight() {
							result: bold;
							@supports (font-variation-settings: "wght" 400) {
								result: 600;
							}
						}

						.dynamic-content {
							color: --dynamic-color();
							font-weight: --dynamic-weight();
						}
					`;
					document.head.appendChild(dynamicStyle);

					const dynamicDiv = document.createElement("div");
					dynamicDiv.className = "dynamic-content";
					dynamicDiv.textContent =
						"This content was added dynamically and should be processed by the polyfill!";
					dynamicDiv.style.padding = "15px";
					dynamicDiv.style.marginTop = "20px";
					dynamicDiv.style.borderRadius = "5px";
					dynamicDiv.style.backgroundColor = "#f0f0f0";

					document
						.querySelector(".container")
						.appendChild(dynamicDiv);
				}, 2000);
			});
		</script>
	</body>
</html>
